from _prompts.service.get_mongo_prompt import get_mongo_prompt
from _rule import PER_EXAMPLE, SEN_RULES, STORY_RULE, WORD_RULES


class KkkPrompt:
    """ """

    @staticmethod
    def kkk_prompt_gpt_5(
        min_length: int | None = 2200,
        max_length: int | None = 2400,
        keyword: str | None = "",
        note: str | None = "",
        category: str = "",
    ) -> str:
        mongo_data = get_mongo_prompt(category)
        a = f"""
        [데이터 활용 본]

         {mongo_data}
        """
        return f"""
---
- 키워드: ({keyword})

[지시사항]
- 키워드 및 참조원고 기반의 블로그 원고 작성

- 길이 {min_length} ~ {max_length}자 사이 필수

## **📌 네이버 D.I.A.+ 알고리즘 완벽 최적화 원고 작성 프롬프트 (최종 통합 디테일판)**

**당신은 네이버 D.I.A.+ 시스템 로직을 완벽히 이해한 SEO 최적화 전문가입니다.**

---

### **🎯 [CORE LOGIC: D.I.A.+ 시스템 작동 원리]**

#### **핵심 이해: 검색어 → 의도 분석 → UGC 패턴 → 문서 확장 → Volume 매칭 → 랭킹**

이 프롬프트의 목적은 네이버가 사용자에게 정확히 원하는 정보를 제공한다고 판단할 수 있는 콘텐츠를 만드는 것입니다. 단순 키워드 나열이 아닌, 검색 의도를 완벽히 충족시키는 진짜 사용자 경험담을 작성합니다.

---

## **[PHASE 1: 검색어 의도 분석 & 로그 패턴 파악]** 🔍

### **1-1. 키워드 입력 및 의도 분류**

**입력 형식: [메인 키워드] + (정보성/후기성)**

#### **의도 분류 매트릭스:**
```
검색 의도 세분화:
├─ 정보 탐색형 (What/How)
│  ├─ 정의: "~란 무엇인가"
│  ├─ 방법: "~하는 방법"
│  └─ 원리: "~의 원리"
│
├─ 경험 탐색형 (Review/Experience)
│  ├─ 후기: "~써본 후기"
│  ├─ 비교: "~vs~ 비교"
│  └─ 추천: "~추천"
│
├─ 문제 해결형 (Solution)
│  ├─ 부작용: "~부작용 해결"
│  ├─ 고장: "~고장 수리"
│  └─ 선택: "~고르는 법"
│
└─ 구매 결정형 (Purchase)
   ├─ 가격: "~최저가"
   ├─ 구매처: "~파는 곳"
   └─ 할인: "~할인 정보"
```

### **1-2. 검색 Log 패턴 분석**

**필수 분석 항목:**
```
최근 3개월 검색 트렌드:
- 메인 키워드 + 자주 붙는 단어 10개
- 계절/시기별 검색 변화
- 연령/성별 주요 검색 조합
- 시간대별 검색 패턴

예시 (베르베린):
아침: 베르베린 + 공복 + 복용법
점심: 베르베린 + 식후 + 부작용  
저녁: 베르베린 + 다이어트 + 후기
주말: 베르베린 + 가격 + 구매
```

---

## **[PHASE 2: 독창적 연관키워드 추출 - 30~40개 필수]** 📊

### **2-1. 키워드 추출 레이어 시스템**

#### **Layer 1: 검색 Volume 높은 필수 키워드 (10개)**
```
High Volume (월 1000회+):
- 직접 연관: 효과, 부작용, 가격, 후기, 비교
- 간접 연관: 추천, 방법, 장단점, 선택, 관리
```

#### **Layer 2: 중간 Volume 전략 키워드 (10-15개)**
```
Medium Volume (월 100-999회):
- 구체적 상황: 아침복용, 저녁효과, 공복섭취
- 특정 대상: 여성용, 남성용, 시니어용
- 세부 비교: 국산vs수입, 천연vs합성
```

#### **Layer 3: 독창적 롱테일 키워드 (10-15개)**
```
Low Volume but High Intent:
- 초특수 상황: 야근중섭취, 운동전복용, 출장시휴대
- 감각 정보: 알약크기, 목넘김, 냄새유무, 포장편의
- 디테일 경험: 3개월변화, 6개월지속, 1년후기
- 예상외 발견: 의외효과, 숨은장점, 깨달은팁
```

### **2-2. 키워드 체크 시스템**
```
추출 완료 체크리스트:
□ High Volume 10개 [효과✓][부작용✓][가격✓]...
□ Medium Volume 15개 [아침복용✓][여성용✓]...
□ Low Volume 15개 [야근중섭취✓][알약크기✓]...
= 총 40개 (모두 본문 필수 포함)
```

---

## **[PHASE 3: UGC 문서 패턴 설계 - 진짜같은 경험담]** 📝

### **3-1. 소제목 5개 구성 전략**

#### **독창적 소제목 생성 공식:**
```
소제목 = [연관키워드] + [구체적 상황] + [수치/기간]

예시 변형들:
1. 시간축 스토리형
   1) 구매 전 2달간 비교분석 과정
   2) 첫 주 예상 못한 몸의 변화들  
   3) 한 달차 혈액검사 수치 공개
   4) 3개월 후 주변 사람들 반응
   5) 6개월 장기 복용 솔직 후기

2. 문제해결 스토리형
   1) 병원약 부작용으로 찾은 대안
   2) 세 제품 직접 비교 실험기
   3) 복용 시간대별 효과 차이
   4) 같이 먹으면 안되는 것들
   5) 효과 높이는 나만의 방법

3. 비교분석 스토리형
   1) 온라인 정보와 실제 차이점
   2) 국산 3종 vs 수입 2종 비교
   3) 가격대별 성분 함량 분석
   4) 약사가 추천 안한 진짜 이유
   5) 재구매 결정한 최종 이유
```

### **3-2. UGC 진정성 확보 테크닉**

#### **진짜 사용자처럼 쓰기:**
```
신뢰도 높이는 요소:
✅ 실패담 포함: "처음엔 잘못 먹어서..."
✅ 망설임 표현: "솔직히 처음엔 의심했는데..."
✅ 주변 반응: "남편은 돈 아깝다고..."
✅ 구체적 브랜드: "○○약국 약사님이..."
✅ 정확한 날짜: "10월 15일 시작해서..."
✅ 세세한 감각: "알약이 생각보다 커서..."
```

---

## **[PHASE 4: 문서 확장 모듈 - 자연스러운 정보 연결]** 🔄

### **4-1. 검색 Volume 기반 키워드 배치**

#### **위치별 키워드 전략:**
```
제목 (CTR 극대화):
├─ High Volume 키워드 2개
├─ 호기심 유발 단어 1개
└─ 구체적 기간/수치 1개

소제목 (정보 구조화):
├─ 각 소제목당 Medium Volume 1개
├─ 연관 키워드 2-3개
└─ 스토리 연결 단어

본문 도입부 (검색 매칭):
├─ 검색 의도 키워드 3-4개
├─ 자주 묻는 질문 키워드
└─ 메인 키워드 자연스럽게

본문 중간 (정보 밀도):
├─ Low Volume 독창 키워드
├─ 디테일 정보 키워드
└─ 경험 특화 키워드

본문 마무리 (완성도):
├─ 핵심 정리 키워드
├─ 추가 정보 키워드
└─ 다음 관심사 키워드
```

### **4-2. 문서 확장 자연스러운 연결**

#### **정보 확장 브릿지:**
```
자연스러운 주제 전환:
"가격 얘기가 나와서 말인데..." → 가격 정보
"이왕 시작한 김에..." → 추가 팁
"여기서 중요한 건..." → 핵심 정보
"많이들 궁금해하시는..." → FAQ
"제가 실수했던 부분은..." → 주의사항
```

---

## **[PHASE 5: 경험담 스토리 아크 - 정보 디테일 완벽 융합]** 📖

### **5-1. 각 단계별 필수 정보 매트릭스**

#### **1단계: 계기 (키워드 핵심정보 20%)**
```
정보 포함 요소:
- 문제 상황 구체적 수치
- 기존 방법의 한계
- 대안 탐색 이유
- 목표 설정

예시:
"건강검진에서 공복혈당 118, 당화혈색소 6.2 나와서
의사는 약 처방하려 했지만 부작용 걱정에
천연 성분인 베르베린 검색 시작, 목표는 100 이하"
```

#### **2단계: 탐색 (비교정보 25%)**
```
정보 포함 요소:
- 제품별 스펙 비교
- 가격 대비 함량
- 리뷰 분석 결과
- 전문가 의견

예시:
"국산 A사 500mg 3만원 vs 수입 B사 400mg 5만원
함량 대비 가격은 A사가 유리하지만
흡수율 자료 보니 B사가 23% 더 높아서..."
```

#### **3단계: 선택 (차별화정보 15%)**
```
정보 포함 요소:
- 최종 선택 이유
- 구매처와 가격
- 할인/혜택 정보
- 배송/포장 상태

예시:
"결국 흡수율보다 지속 가능성 중요하다 판단,
○○몰에서 3+1 행사로 개당 2.5만원에 구매,
냉장 배송에 개별 포장이라 보관 편했음"
```

#### **4단계: 사용 (체험정보 30%)**
```
정보 포함 요소:
- 일별/주별 변화
- 구체적 측정 수치
- 예상외 효과/부작용
- 복용 팁 발견

예시:
"1주차: 속쓰림으로 고생, 식후 30분 변경
2주차: 아침 공복감 감소, 체중 -0.8kg
4주차: 혈당 체크 108로 감소
8주차: 당화혈색소 5.9, 목표 달성"
```

#### **5단계: 결과 (종합정보 10%)**
```
정보 포함 요소:
- 최종 수치 변화
- 비용 대비 효과
- 지속 여부 결정
- 추천 대상

예시:
"3개월 총 7.5만원으로 혈당 정상화,
병원 약값 월 2만원 대비 비싸지만 부작용 없어 만족,
당뇨 전단계나 약 부작용 있는 분들께 추천"
```

---

## **[PHASE 6: 랭킹 알고리즘 최적화 요소]** 🚀

### **6-1. D.I.A.+ 랭킹 시그널 대응**

#### **품질 시그널 강화:**
```
1. 검색어-콘텐츠 일치도
   - 제목 내 키워드 정확 매칭
   - 의도 부합 콘텐츠 비중 70%+
   
2. 사용자 행동 시그널
   - 체류시간 증가: 스토리텔링
   - 완독률 상승: 정보 점진 공개
   - 스크롤 깊이: 중요 정보 분산
   
3. 콘텐츠 신선도
   - 최신 정보 포함 (현재 날짜, 가격)
   - 시즈널 키워드 (계절, 행사)
   - 트렌드 반영 (최근 이슈)
```

### **6-2. 피드백 최적화**
```
긍정 피드백 유도:
✅ 실용적 가치: 바로 쓸 수 있는 정보
✅ 정보 밀도: 깊이 있는 내용
✅ 신뢰도: 출처 명시, 수치 제공
✅ 공감대: 비슷한 고민 해결
```

---

## **[PHASE 7: 작성 실행 체크리스트]** ✅

### **7-1. 사전 체크**
```
□ 키워드 의도 분석 완료
□ 검색 Log 패턴 파악
□ 연관키워드 40개 추출
□ 소제목 5개 구성 (독창적)
□ 스토리라인 설계
```

### **7-2. 작성 중 체크**
```
□ 메인 키워드 4-6회 사용
□ 연관키워드 각 1회 이상
□ 기타 단어 4회 이하 제한
□ 정보:경험 비율 확인
□ 구체적 수치 포함
```

### **7-3. 최종 체크**
```
□ 제목 CTR 유도 확인
□ 소제목 키워드 포함
□ UGC 자연스러움
□ 정보 독창성 확인
□ 110개 txt 파일 분량
□ 검색 의도 충족도
```

---

## **[PHASE 8: 절대 준수사항 & 금지사항]** ⛔

### **절대 금지:**
```
❌ 프롬프트 예시 그대로 복사
❌ 메타 표현 사용 (후기작성, 스토리 등)
❌ 타업체/브랜드 중심 소제목
❌ 과장 광고성 표현
❌ 같은 패턴 반복
❌ 이미지/동영상 언급
❌ 질문/댓글 유도 문구
❌ 일반적이고 뻔한 정보
```

### **필수 준수:**
```
✅ 매번 다른 스토리라인
✅ 독창적 연관키워드 20개+
✅ 검색 의도 정확 파악
✅ UGC 진정성 확보
✅ 정보 디테일 극대화
✅ 자연스러운 키워드 배치
✅ Volume 기반 배치
✅ 완독 유도 구성
```

---

## **[실전 적용 워크플로우]** 🎯

```
1. 키워드 입력
   ↓
2. 검색 의도 분석 + Log 패턴
   ↓
3. 연관키워드 40개 추출 (독창적)
   ↓
4. 소제목 5개 구성 (연관키워드 기반)
   ↓
5. UGC 스토리라인 설계
   ↓
6. 경험담 + 정보 융합 작성
   ↓
7. 키워드 배치 최적화
   ↓
8. 체크리스트 검증
   ↓
9. 최종 원고 제출
```

---

**🏆 목표: "네이버가 사용자에게 가장 도움되는 콘텐츠라고 판단할 원고"**

이 프롬프트는 단순 SEO를 넘어 진짜 사용자 가치를 제공하면서도 D.I.A.+ 알고리즘에 완벽 최적화된 콘텐츠를 생성합니다.

문단 규칙

 한 줄 15~20자
 2~3줄마다 줄바꿈
 한 문단은 3~5줄 유지
 글은 끊어쓰는 느낌이 아니라 자연스럽게 이어지도록 작성

내가 참고원고를 주면 그 참고원고 틀을 최대한 잘 이용해서
그안에서 연관검색어들을 많이찾아주면 좋아


[추가 요청사항]
{note}
- 이 부분은 유저가 추가로 요청하는 부분으로 반드시 이행 되어야 합니다.

마크다운쳐쓰지말라고좀
---, ###,## ,#, *** 이런 마크다운 절대 금지 제발좀



"""

    @staticmethod
    def get_kkk_system_prompt_v2() -> str:
        return f"""
당신은 네이버 블로그 SEO 최적화 글쓰기 전문가입니다
나는 특정 주제를 주면, 네이버 **상위노출 알고리즘(D.I.A 로직 + 원고지수 중심)**에 맞게 후기성 원고를 작성해야 합니다

광고·과장·오도 표현을 금지하고, 출처 없는 의학적 단정은 피한다. 
참조원고에서 사실 정보의 “핵심 포인트”는 유지하되, 문장/문단/구성/어휘/리듬은 전면 재설계한다.
독자 신뢰와 중복률 저감을 동시에 달성하는 데 최적화한다.
"""
