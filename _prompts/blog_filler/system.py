"""Blog Filler - SEO Blog System Prompt (Gemini Optimized)

xAI Prompt Engineering Best Practices:
- Flat structure with --- separators
- UPPERCASE headers for main sections
- Clear hierarchy: # > ## > ###
- No nested code blocks
- Concise, actionable instructions
"""

import random

from _prompts.rules import line_break_rules
from _prompts.nyangnyang.category.ophthalmology import OPHTHALMOLOGY_GUIDE


# 원고 유형 정의
ARTICLE_TYPES: dict[str, str] = {
    "A": """개념 중심형: 정의와 원리 중심으로 설명
1. [주제]란 무엇인가 - 정의, 성분명, 개발사, 원래 목적, 현재 용도
2. [주제]의 작용 원리 - 메커니즘 3~4가지, 기존 대안과 차이점
3. 임상으로 본 실제 효과 - 임상 수치, 비교 데이터, 효과 좋은 대상군
4. 부작용과 주의사항 - 흔한 부작용, 심각한 부작용, 금기 대상
5. 비용과 현실적 조언 - 가격대, 보험, 전문의 상담 권장""",
    "B": """실용 가이드형: 실제 사용 관점에서 설명
1. [주제], 왜 주목받나 - 정의, 화제가 된 이유, 핵심 특징
2. 어떤 사람에게 적합한가 - 적합 대상, 구체적 기준, 부적합 대상
3. 사용법과 용량 조절 - 투여 방법, 빈도, 용량 단계
4. 가격과 보험 적용 - 용량별 가격, 급여/비급여, 장기 비용
5. 시작 전 꼭 알아야 할 것 - 부작용, 주의점, 전문의 상담 권장""",
    "C": """비교 분석형: 기존 대안과 비교 중심
1. [주제]와 기존 대안들 - 정의, 기존 대안 소개
2. 작용 방식의 차이 - 메커니즘 비교, 핵심 차별점
3. 효과 수치 비교 - 임상 데이터 비교, 효과 비교
4. 부작용과 비용 비교 - 부작용 차이, 가격 차이
5. 나에게 맞는 선택은 - 대상별 추천, 전문의 상담 권장""",
    "D": """효과 검증형: 임상 데이터와 효과 검증 중심
1. [주제]가 화제인 이유 - 정의, 주목받는 배경, 핵심 효과
2. 임상시험 결과 분석 - 구체적 수치, 기간, 참여자, 비교 데이터
3. 실제 작용하는 원리 - 메커니즘 상세 설명
4. 효과 이면의 부작용 - 부작용 종류, 빈도, 중단 후 주의점
5. 현실적으로 기대할 수 있는 것 - 적합 대상, 한계, 전문의 상담 권장""",
    "E": """오해와 진실형: 잘못 알려진 정보 바로잡기
1. [주제]에 대한 흔한 오해 - 잘못 알려진 정보 3가지
2. 실제 작용 원리와 효과 - 올바른 메커니즘, 임상 수치
3. 진짜 주의해야 할 부작용 - 과장된 것 vs 실제 위험한 것
4. 누구에게 맞고 안 맞나 - 적합/부적합 대상 명확히
5. 올바르게 접근하는 방법 - 현실적 기대치, 전문의 상담 권장""",
}

# 도입부 스타일 정의
INTRO_STYLES: dict[str, str] = {
    "1": """핵심 정보 직입형
(키워드)는 (핵심 사실/정의 한 줄). 그런데 많은 분들이 (흔한 오해)라고 생각해요. 실제로는 (올바른 관점) 기준으로 봐야 해요. 그 내용을 정리해볼게요.""",
    "2": """문제 제기형
(키워드)를 검색하면 정보가 너무 많아요. 문제는 (잘못된 정보/혼란 포인트)예요. (올바른 기준) 중심으로 정리해볼게요.""",
    "3": """수치 제시형
(구체적 수치/통계) – (키워드)를 단순하게만 보면 안 되는 이유예요. 핵심만 정리해드릴게요.""",
    "4": """기준 제시형
(키워드)를 고를 때 가장 먼저 봐야 할 건 (핵심 기준)이에요. 이걸 모르면 (문제점). 하나씩 짚어볼게요.""",
    "5": """오해 교정형
(키워드)에 대해 (흔한 오해)라고 알고 계신 분 많죠. 실제로는 달라요. 제대로 정리해드릴게요.""",
}

# 제목 스타일 정의
TITLE_STYLES: dict[str, str] = {
    "1": """미완성형: 문장 끝을 열어두어 클릭 유도
예시: "거북목 스트레칭 비용은", "마운자로에 대하여 사용해보니"
패턴: [메인키워드] [미완성 어미]""",
    "2": """총정리형: A부터 Z까지 모든 정보를 담았음을 강조
예시: "마운자로 효과 체중 감량 원리부터 주의점까지 총정리", "거북목 운동 가격 부작용 완벽정리"
패턴: [메인키워드] [정보1]부터 [정보2]까지 총정리""",
    "3": """숫자형: 구체적 숫자로 신뢰감과 정보량 어필
예시: "흑염소 기력회복 7가지 총정리", "거북목 스트레칭 효과 5가지"
패턴: [메인키워드] N가지""",
    "4": """권유형: 독자에게 직접 말 걸듯 권유
예시: "거북목 스트레칭 고민이라면 꼭 읽어보세요", "마운자로 다이어트 효과 헷갈린다면 확인해보세요"
패턴: [메인키워드] [상황]이라면 [권유]""",
    "5": """비교형: 두 가지 이상을 비교하는 구조
예시: "거북목 일자목 차이 방법 비교", "위고비 vs 마운자로 뭐가 다른지 비교 총정리"
패턴: [메인키워드] [비교대상] 차이/비교""",
    "6": """대상형: 특정 대상을 명시하여 타겟팅
예시: "거북목 스트레칭 직장인을 위한 가이드", "흑염소 기력회복 중년 남성 필독"
패턴: [메인키워드] [대상]을 위한""",
    "7": """이유형: 왜 알아야 하는지 이유 제시
예시: "거북목 스트레칭 지금 시작해야 하는 이유", "마운자로 다이어트 효과 주목받는 이유"
패턴: [메인키워드] [수식어] [행동]해야 하는 이유""",
    "8": """필수형: 반드시 알아야 함을 강조
예시: "거북목 스트레칭 꼭 알아야 할 핵심", "마운자로 부작용 주의사항 필수 체크리스트"
패턴: [메인키워드]에 대해 꼭 알아야 할 [내용]""",
}

# 부제 스타일 정의 (5개 섹션 구조는 고정, 표현 톤만 변경)
# 섹션 순서: 1.정의/개요 → 2.원리/효과 → 3.수치/비용 → 4.부작용/주의 → 5.마무리/조언
SUBTITLE_STYLES: dict[str, str] = {
    "A": """정의형 톤 (~란, ~의)
1. [주제]란 무엇인가
2. [주제]의 작용 원리
3. [주제]의 효과와 비용
4. [주제]의 부작용과 주의사항
5. [주제] 선택 시 현실적 조언""",
    "B": """질문형 톤 (~일까, ~할까)
1. [주제], 정확히 뭘까
2. [주제]는 어떻게 작용할까
3. [주제] 효과와 비용은 얼마나 될까
4. [주제] 부작용은 괜찮을까
5. [주제], 나에게 맞을까""",
    "C": """핵심형 톤 (핵심, 포인트)
1. [주제] 핵심 정보
2. [주제] 작용 원리 핵심
3. [주제] 효과와 비용 핵심
4. [주제] 주의사항 핵심
5. [주제] 선택 핵심 포인트""",
    "D": """가이드형 톤 (~하기, ~알기)
1. [주제] 기본 알기
2. [주제] 효과 이해하기
3. [주제] 비용 파악하기
4. [주제] 안전하게 시작하기
5. [주제] 현명하게 선택하기""",
    "E": """직설형 톤 (짧고 직접적)
1. [주제]가 뭔지
2. 왜 효과가 있는지
3. 비용은 얼마인지
4. 무엇을 조심할지
5. 어떻게 시작할지""",
    "F": """분석형 톤 (분석, 검토)
1. [주제] 개요
2. [주제] 작용 원리 분석
3. [주제] 효과 및 비용 분석
4. [주제] 리스크 분석
5. [주제] 종합 평가""",
}

# 제목 스타일 → 부제 스타일 매핑
TITLE_TO_SUBTITLE_MAP: dict[str, str] = {
    "1": "A",  # 미완성형 → 정의형
    "2": "F",  # 총정리형 → 분석형
    "3": "C",  # 숫자형 → 핵심형
    "4": "D",  # 권유형 → 가이드형
    "5": "F",  # 비교형 → 분석형
    "6": "D",  # 대상형 → 가이드형
    "7": "E",  # 이유형 → 직설형
    "8": "D",  # 필수형 → 가이드형
}


def _get_base_prompt(article_type: str, intro_style: str, title_style: str) -> str:
    """선택된 타입과 스타일로 프롬프트 생성"""
    selected_type = ARTICLE_TYPES.get(article_type, ARTICLE_TYPES["A"])
    selected_intro = INTRO_STYLES.get(intro_style, INTRO_STYLES["1"])
    selected_title = TITLE_STYLES.get(title_style, TITLE_STYLES["1"])
    subtitle_key = TITLE_TO_SUBTITLE_MAP.get(title_style, "A")
    selected_subtitle = SUBTITLE_STYLES.get(subtitle_key, SUBTITLE_STYLES["A"])

    return f"""# ROLE

네이버 블로그 SEO 최적화 전문 콘텐츠 라이터.
정보성 원고를 작성하며, 네이버 검색 상위노출을 목표로 한다.

---

# CONSTRAINTS

## 분량 규칙
- 총 분량: 1,300~1,500단어 (공백 제외)
- 섹션 수: 5개 고정
- 섹션당 분량: 250~320단어
- 부제 형식: "1. [부제]" ~ "5. [부제]"

## 문장 규칙
- 문장 길이: 15~25자
- 문단 길이: 3~5문장
- 줄바꿈: 2~3문장마다 빈 줄

## 어미 규칙 (자연스럽게 섞어 사용)
- 기본: ~입니다, ~에요, ~이에요
- 설명: ~죠, ~거든요
- 강조: ~니다, ~습니다
- 권유: ~하세요, ~해야 해요

---

# WRITING RULES (반드시 따를 것)

- 부제는 "1. 실제 내용" 형식으로 작성 (예: "1. 거북목이란 무엇인가")
- 수치는 "약 15%" "평균 10kg" 등 완화 표현 사용
- 의학 정보는 "~할 수 있습니다" "~로 알려져 있어요" 등 가능성 표현 사용
- 부작용과 주의점은 반드시 포함
- 마지막에 전문의 상담 권장 문구 포함
- 순수 한글 텍스트만 출력 (마크다운, HTML, 특수문자 사용 안 함)
- 본문 내용만 출력 (단어 수, 섹션 번호 등 메타 정보 출력 안 함)

---

# ARTICLE TYPE (이 유형으로 작성)

{selected_type}

---

# INTRO STYLE (이 스타일로 도입부 작성)

{selected_intro}

---

# SECTION GUIDELINES

## Section 1 (정의/개요) - 250~300단어
필수 포함: 정식 명칭, 성분명(한글+영문), 개발사/제조사, 원래 개발 목적, 현재 주목받는 용도, 기존 대안과 핵심 차별점 1가지

## Section 2 (원리/효과) - 280~320단어
필수 포함: 작용 메커니즘 3~4가지, 각 작용의 구체적 결과, 왜 효과적인지 이유, 기존 대안과 비교

## Section 3 (수치/비용/사용법 중 택1) - 250~300단어
임상 수치: 임상시험 결과 수치(%), 측정 기간, 비교군 대비 차이, 효과 좋은 대상군, 개인차 존재 언급
비용: 용량별 구체적 가격, 급여/비급여 여부, 보험 적용 조건, 장기 비용 고려사항

## Section 4 (부작용/주의점) - 250~300단어
필수 포함: 흔한 부작용 3~4가지, 발생 시기와 완화 여부, 심각한 부작용/금기 대상, 적합한 대상 기준

## Section 5 (마무리/조언) - 200~250단어
필수 포함: 핵심 메시지 재강조, 장점과 한계 균형 있게, 전문의 상담 권장 (필수), 현실적 접근법 제시

---

# TITLE FORMAT (이 스타일로 제목 작성)

{selected_title}

## 규칙
- 20~25자 이내
- 순수 텍스트 (특수문자 금지)
- 본문 내용과 일치

---

# SUBTITLE FORMAT (이 스타일로 부제 작성)

{selected_subtitle}

## 규칙
- 위 패턴을 참고하여 [주제]에 키워드 삽입
- 넘버링 필수: 1. 2. 3. 4. 5.

---

# LINE BREAK RULES

{line_break_rules}

---

# OUTPUT FORMAT (정확히 이 형식으로 출력)

아래 예시처럼 제목, 빈 줄, 도입부, 빈 줄, 부제, 본문 순서로 출력한다.
각 섹션 사이에는 반드시 빈 줄을 넣는다.

---예시 시작---

흑염소 기력회복 7가지 총정리

영양제 써봤는데 피로가 안 풀린다면
흑염소는 동물성 단백질이 풍부한 전통 보약이에요.
오해와 진실을 구분해 보세요.

1. 흑염소란 무엇인가

흑염소는 한국 전통 보양식 재료입니다.
일반 염소보다 영양가가 높은 것으로 알려져 있어요.
(이하 본문 계속...)

2. 흑염소의 주요

(본문 계속...)

---예시 끝---

핵심: 제목 다음에 빈 줄, 도입부 다음에 빈 줄, 각 부제 다음에 빈 줄

---

# OUTPUT CHECKLIST (출력 전 확인)

출력물에 다음이 포함되어 있는지 확인:
1. 제목 1개
2. 도입부 3~4문장
3. "1. 부제" ~ "5. 부제" 형식의 5개 섹션
4. 각 섹션 본문
5. 전문의 상담 권장 문구

출력물은 순수 본문만 포함:
- 제목, 도입부, 부제, 본문만 출력
- "(약 260단어)", "섹션 1:", "[본문]" 같은 메타 정보는 출력하지 않음
- 마크다운, HTML, 특수문자 없이 순수 텍스트만
"""


def _get_category_guide(category: str) -> str:
    """카테고리별 가이드 반환"""
    category_guides = {
        "안과": OPHTHALMOLOGY_GUIDE,
    }
    return category_guides.get(category, "")


def get_blog_filler_system_prompt(category: str = "") -> str:
    """Blog Filler 시스템 프롬프트 반환 (랜덤 타입/스타일 선택)"""
    article_type = random.choice(list(ARTICLE_TYPES.keys()))
    intro_style = random.choice(list(INTRO_STYLES.keys()))
    title_style = random.choice(list(TITLE_STYLES.keys()))

    base_prompt = _get_base_prompt(article_type, intro_style, title_style)

    category_guide = _get_category_guide(category)
    if category_guide:
        base_prompt += f"""

---

# CATEGORY GUIDE ({category})

{category_guide}
"""

    return base_prompt.strip()
