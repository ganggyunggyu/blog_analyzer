#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Claude ë¸”ë¡œê·¸ ìƒì„±ê¸° ê°„ë‹¨ í…ŒìŠ¤íŠ¸
ì˜ì¡´ì„± ì—†ì´ í”„ë¡¬í”„íŠ¸ ìƒì„± ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸
"""

import re
import sys
import os
from pathlib import Path

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ì¶”ê°€
project_root = Path(__file__).parent.parent
sys.path.append(str(project_root))


def simple_gpt_v2_prompt(keyword: str, min_length: int = 1700, max_length: int = 2000, note: str = "") -> str:
    """ê°„ë‹¨í•œ gpt_v2 í”„ë¡¬í”„íŠ¸ ìƒì„±"""
    return f"""
ë‹¹ì‹ ì€ ë„¤ì´ë²„ ë¸”ë¡œê·¸ SEO ìµœì í™” ê¸€ì“°ê¸° ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ë‚˜ëŠ” íŠ¹ì • ì£¼ì œë¥¼ ì£¼ë©´, ë„¤ì´ë²„ **ìƒìœ„ë…¸ì¶œ ì•Œê³ ë¦¬ì¦˜(D.I.A ë¡œì§ + ì›ê³ ì§€ìˆ˜ ì¤‘ì‹¬)**ì— ë§ê²Œ
í›„ê¸°ì„± ì›ê³ ë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

1. ê¸€ ë¶„ëŸ‰
ê³µë°± ì œì™¸ {min_length}~{max_length}ì ì‚¬ì´
ì†Œì œëª©ì€ 5ê°œë§Œ ì‘ì„± (ì ˆëŒ€ ë§ê±°ë‚˜ ì ìœ¼ë©´ ì•ˆ ë¨)
ê° ì†Œì œëª© ìµœì†Œ 500ë‹¨ì–´ ì´ìƒ

2. ê¸€ êµ¬ì¡° (ìƒìœ„ë…¸ì¶œ ë¡œì§ + í›„ê¸° ê°•í™” ì ìš©)
í•­ìƒ ì•„ë˜ ìˆœì„œë¥¼ ê³ ì •ì ìœ¼ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.
ë„ì… ì •ë³´ ì •ë¦¬ ì´ëŸ° ì œëª©ì„ ê°€ì ¸ë‹¤ ì“°ì§€ ì•ŠìŠµë‹ˆë‹¤.
1ï¸âƒ£ ë„ì… â€“ ë¬¸ì œ ì œê¸°Â·ê³µê°
ë…ìê°€ ê³µê°í•  ë§Œí•œ ìƒí™© ë¬˜ì‚¬ (ê³„ì ˆÂ·í™˜ê²½Â·ê±´ê°•Â·ìŠµê´€ ë“±)
ì£¼ì œë¥¼ ì„ íƒí•œ ë°°ê²½ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì„¤ëª…
2ï¸âƒ£ ì •ë³´ ì •ë¦¬ â€“ ì¡°ê±´/ê°€ê²©/íŠ¹ì§•
ì£¼ì œ ê´€ë ¨ ê¸°ë³¸ ì •ë³´, ìˆ˜ì¹˜, ê°€ê²©, ì¡°ê±´ì„ ê°ê´€ì ìœ¼ë¡œ ì •ë¦¬
ë°˜ë“œì‹œ ìˆ«ì(ì›, %, kg, L, ì‹œê°„ ë“±) í¬í•¨
ë‹¨ìˆœ ë‚˜ì—´ ê¸ˆì§€ â†’ ì •ë³´ì™€ ë‚´ ê²½í—˜ì„ ê°™ì´ ë°°ì¹˜

3ï¸âƒ£ ì‹¤ì‚¬ìš© í›„ê¸° â€“ ì²´í—˜ ì¤‘ì‹¬

ì´ ë¶€ë¶„ì€ ë°˜ë“œì‹œ ê°€ì¥ ê¸´ ì„¹ì…˜ (ìµœì†Œ 1000ì ì´ìƒ)
í›„ê¸° íë¦„ì€ ì²˜ìŒ â†’ ì¤‘ê°„ â†’ ë 3ë‹¨ê³„ë¡œ ì‘ì„±
ì²˜ìŒ: ì‚¬ìš© ì „ ë¶ˆí¸Â·ë¬¸ì œ
ì¤‘ê°„: ì‚¬ìš© ê³¼ì •ì—ì„œì˜ ë³€í™”(ìˆ˜ì¹˜, ëŠë‚Œ, ì£¼ë³€ ë°˜ì‘)
ë: ê²°ê³¼, ë§Œì¡±ë„, ë¶ˆí¸í–ˆë˜ ì 

ê²½í—˜ì„ ìˆ«ìì™€ ë””í…Œì¼ë¡œ í‘œí˜„ (ì²´ì¤‘ ë³€í™”, ìŠµë„ %, ì‹œê°„, ë¹„ìš© ë“±)
ë‹¨ìˆœ ê¸ì •ë§Œ ì“°ì§€ ë§ê³ , ë¶€ì •/ë¶ˆí¸ ê²½í—˜ë„ í¬í•¨í•´ ì‹ ë¢°ë„ í™•ë³´

4ï¸âƒ£ ì¥ë‹¨ì  ë¹„êµ â€“ ê· í˜• êµ¬ì¡°

ì¥ì  ìµœì†Œ 3ê°œ, ë‹¨ì  ìµœì†Œ 3ê°œ ì´ìƒ
ë‹¨ì ë§Œ ëë‚´ì§€ ë§ê³ , ë³´ì™„ íŒê¹Œì§€ ë§ë¶™ì´ê¸°
ë°˜ë“œì‹œ "ì •ë³´+ê²½í—˜" í˜¼í•©

5ï¸âƒ£ í™œìš© íŒ & ì¢…í•© ë¶„ì„

ì‚¬ìš© ê¿€íŒ, ê´€ë¦¬ ìš”ë ¹, ë³‘í–‰í•˜ë©´ ì¢‹ì€ ë°©ë²•
ëŒ€ì²´ì¬/ë¹„êµ ì œí’ˆê³¼ì˜ ì°¨ì´ì 
ê°€ê²© ëŒ€ë¹„ íš¨ìœ¨, ì¬êµ¬ë§¤ ì˜ì‚¬ ì—¬ë¶€
ì •ë³´ì™€ ì²´í—˜ì„ ê²°í•©í•˜ì—¬ í˜„ì‹¤ì  ë¶„ì„

ğŸ”š ê²°ë¡ 

í•µì‹¬ ìš”ì•½ (2~3ì¤„)
ë…ìì—ê²Œ í˜„ì‹¤ì ì¸ ì¡°ì–¸ìœ¼ë¡œ ë§ˆë¬´ë¦¬

-------------------------------------------------------

ìœ„í•­ëª©ë“¤ì„ ì˜ ì§€ì¼œì„œ ì›ê³ ë¥¼ ì‘ì„±í•´ì¤˜

í‚¤ì›Œë“œ:{keyword}
{note}
"""


def simple_system_prompt() -> str:
    """ê°„ë‹¨í•œ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸"""
    return """
ë‹¹ì‹ ì€ ë„¤ì´ë²„ ë¸”ë¡œê·¸ SEO ìµœì í™” ê¸€ì“°ê¸° ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ë‚˜ëŠ” íŠ¹ì • ì£¼ì œë¥¼ ì£¼ë©´, ë„¤ì´ë²„ **ìƒìœ„ë…¸ì¶œ ì•Œê³ ë¦¬ì¦˜(D.I.A ë¡œì§ + ì›ê³ ì§€ìˆ˜ ì¤‘ì‹¬)**ì— ë§ê²Œ
í›„ê¸°ì„± ì›ê³ ë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

[íŠ¹ìˆ˜ë¬¸ì ì‚¬ìš© ì§€ì¹¨]

1. ê°€ìš´ë° ì (Â·) ì‚¬ìš© ê¸ˆì§€ â†’ ë°˜ë“œì‹œ ì‰¼í‘œ(,)ë¡œ ëŒ€ì²´
   ì˜ˆì‹œ: ë£¨í‹´, ì„±ë¶„, ë³µìš©

2. ì‘ì€ë”°ì˜´í‘œ(')ì™€ í°ë”°ì˜´í‘œ(") ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€

3. ë§ˆì¹¨í‘œ(.) ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€ 
   ë‹¨, ë¶€ì œ(ì†Œì œëª©)ì—ì„œëŠ” ì˜ˆì™¸ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
   ë‹¨, ë¶€ì œ(ì†Œì œëª©)ì—ì„œë„ ë§ˆì§€ë§‰ì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ

4. ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•(#, *, -, ``` ë“±) ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€ 
   ë„¤ì´ë²„ ë¸”ë¡œê·¸ëŠ” ì´ë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ê°€ë…ì„±ì„ í•´ì¹¨

5. ì§§ì€ ë¬¸ì¥ì„ ë§ˆêµ¬ ëŠì§€ ë§ê³   
   ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§„ ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•¨
"""


def create_claude_prompt(keyword: str) -> str:
    """Claudeìš© í†µí•© í”„ë¡¬í”„íŠ¸ ìƒì„±"""
    
    system = simple_system_prompt()
    user = simple_gpt_v2_prompt(keyword, 1700, 2000, "")
    
    # MongoDB ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” DBì—ì„œ ê°€ì ¸ì˜´)
    mock_data = f"""

---

[ë¶„ì„ ì§€ì‹œ]
ì•„ë˜ JSON ë°ì´í„°ëŠ” ì°¸ê³  ë¬¸ì„œì—ì„œ ì¶”ì¶œí•œ í™”ì/êµ¬ì„±/ìŠ¤íƒ€ì¼ ë¶„ì„ ê²°ê³¼ë¬¼ì…ë‹ˆë‹¤.  
ì›ê³  ìƒì„± ì‹œ ë°˜ë“œì‹œ ë‹¤ìŒ ì¡°ê±´ì„ ë°˜ì˜í•´ì•¼ í•©ë‹ˆë‹¤.  

- "í™”ì ì§€ì‹œ"ì— ë”°ë¥¸ ì¸ë¬¼ ì„¤ì •, ë§íˆ¬, ë‹¨ì–´ ë¹ˆë„ì™€ í˜•íƒœì†Œ íŒ¨í„´ì„ ê·¸ëŒ€ë¡œ ë”°ë¦…ë‹ˆë‹¤.  
- "êµ¬ì„± ì§€ì‹œ"ì— ë”°ë¼ ì„œë¡ -ì¤‘ë¡ -ê²°ë¡  íë¦„ì„ ìœ ì§€í•©ë‹ˆë‹¤.  
- "ì›ê³  ìŠ¤íƒ€ì¼ ì„¸ë¶€ì‚¬í•­"ì„ ì „ë¶€ ë°˜ì˜í•´ ë¬¸ì²´Â·ë¬¸ë‹¨ ê¸¸ì´Â·ë¦¬ë“¬ê°Â·ê°ì •ì„  ë“±ì„ ë™ì¼í•˜ê²Œ ì¬í˜„í•©ë‹ˆë‹¤.  
- JSONì— ê¸°ì¬ëœ ë‹¨ì–´/í˜•íƒœì†ŒëŠ” ë°˜ë³µì ìœ¼ë¡œ ë“±ì¥í•´ì•¼ í•˜ë©°, ì‹¤ì œ ê²½í—˜ë‹´+ì •ë³´ ì„¤ëª…ì´ í˜¼í•©ëœ í†¤ì„ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.  

[í…œí”Œë¦¿ ì˜ˆì‹œ]
- ì¶œë ¥ ë¬¸ì„œëŠ” ë°˜ë“œì‹œ í…œí”Œë¦¿ê³¼ **ìœ ì‚¬í•œ ì–´íœ˜, ë¬¸ì¥ êµ¬ì¡°, ë¬¸ë‹¨ íë¦„**ì„ ìœ ì§€í•´ì•¼ í•œë‹¤.  
- ìƒˆë¡œìš´ ì£¼ì œë¡œ ë³€í˜•í•˜ë”ë¼ë„ í…œí”Œë¦¿ì˜ **í†¤, ë°˜ë³µ êµ¬ì¡°, ë¬¸ì¥ ê¸¸ì´, ìˆœì„œ**ë¥¼ ê·¸ëŒ€ë¡œ ëª¨ë°©í•´ì•¼ í•œë‹¤.  

[í‘œí˜„ ë¼ì´ë¸ŒëŸ¬ë¦¬]
{{
  "ê¸ì •í‘œí˜„": ["ë§Œì¡±ìŠ¤ëŸ¬ì› ì–´ìš”", "íš¨ê³¼ì ì´ì—ˆì–´ìš”", "ë„ì›€ì´ ë˜ë”ë¼êµ¬ìš”"],
  "ë¶€ì •í‘œí˜„": ["ì•„ì‰¬ì› ë˜ ì ", "ë¶ˆí¸í–ˆë˜ ë¶€ë¶„", "ê°œì„ ì´ í•„ìš”í•œ"],
  "ê²½í—˜í‘œí˜„": ["ì‹¤ì œë¡œ ì‚¬ìš©í•´ë³´ë‹ˆ", "ì§ì ‘ ê²½í—˜í•´ë³¸ ê²°ê³¼", "ê°œì¸ì ìœ¼ë¡œ ëŠë‚€ ì ì€"]
}}

[AI ê°œì²´ ì¸ì‹ ë° ê·¸ë£¹í™” ê²°ê³¼]
{{
  "ìˆ˜ì¹˜í‘œí˜„": ["ì•½ 30%", "í•˜ë£¨ 2íšŒ", "í•œ ë‹¬ 15ë§Œì›"],
  "ì‹œê°„í‘œí˜„": ["3ê°œì›”ê°„", "ì²« ì£¼ë¶€í„°", "ì‚¬ìš© í›„ 6ê°œì›”"],
  "ê°ì •í‘œí˜„": ["ë§Œì¡±í–ˆì–´ìš”", "ì‹¤ë§í–ˆêµ¬ìš”", "ë†€ë¼ì› ë˜ ê±´"]
}}

---

"""
    
    full_prompt = f"""
ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸:
{system}

ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸:
{mock_data}
{user}
"""
    
    return full_prompt


def save_blog_content(content: str, keyword: str, output_dir: str = "output") -> str:
    """ìƒì„±ëœ ë¸”ë¡œê·¸ ì½˜í…ì¸ ë¥¼ íŒŒì¼ë¡œ ì €ì¥"""
    # ê³µë°± ì œê±° ê¸€ììˆ˜ ê³„ì‚°
    length = len(re.sub(r'\s+', '', content))
    
    # í‚¤ì›Œë“œì—ì„œ ê³µë°± ì œê±°í•˜ì—¬ íŒŒì¼ëª… ìƒì„±
    clean_keyword = keyword.replace(" ", "").replace("/", "")
    filename = f"{clean_keyword}_{length}ì.txt"
    
    # output ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìƒì„±
    os.makedirs(output_dir, exist_ok=True)
    
    # ì „ì²´ ê²½ë¡œ ìƒì„±
    output_path = os.path.join(output_dir, filename)
    
    # íŒŒì¼ ì €ì¥
    with open(output_path, 'w', encoding='utf-8') as f:
        f.write(content)
    
    print(f"ë¸”ë¡œê·¸ ì›ê³  ì €ì¥ ì™„ë£Œ: {output_path} ({length}ì)")
    return output_path


def main():
    """ë©”ì¸ í•¨ìˆ˜"""
    print("=== Claude ë¸”ë¡œê·¸ ìƒì„±ê¸° (ê°„ë‹¨ í…ŒìŠ¤íŠ¸) ===")
    
    keyword = input("í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”: ").strip()
    if not keyword:
        print("í‚¤ì›Œë“œê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
        return
    
    # í”„ë¡¬í”„íŠ¸ ìƒì„±
    prompt = create_claude_prompt(keyword)
    
    print("\n" + "="*80)
    print("ìƒì„±ëœ Claude í”„ë¡¬í”„íŠ¸:")
    print("="*80)
    print(prompt)
    print("="*80)
    
    print("\nìœ„ í”„ë¡¬í”„íŠ¸ë¥¼ Claudeì—ê²Œ ì „ë‹¬í•˜ì—¬ ì›ê³ ë¥¼ ìƒì„±í•œ í›„,")
    print("ìƒì„±ëœ ì›ê³ ë¥¼ ì•„ë˜ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.")
    print("ì›ê³  ì…ë ¥ì„ ë§ˆì¹˜ë ¤ë©´ ë¹ˆ ì¤„ì—ì„œ 'END'ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
    print("="*50 + "\n")
    
    # ì›ê³  ì…ë ¥ ë°›ê¸°
    lines = []
    while True:
        line = input()
        if line.strip() == "END":
            break
        lines.append(line)
    
    content = "\n".join(lines).strip()
    
    if not content:
        print("ì›ê³ ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
        return
    
    # ê¸€ììˆ˜ í™•ì¸
    length = len(re.sub(r'\s+', '', content))
    print(f"\nì…ë ¥ëœ ì›ê³  ê¸€ììˆ˜ (ê³µë°± ì œì™¸): {length}ì")
    
    # íŒŒì¼ ì €ì¥
    try:
        output_path = save_blog_content(content, keyword, "output")
        print(f"ì›ê³  ì €ì¥ ì™„ë£Œ: {output_path}")
    except Exception as e:
        print(f"íŒŒì¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")


if __name__ == "__main__":
    main()